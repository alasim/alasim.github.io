---
import HorizontalCard from "../components/HorizontalCard.astro";
import projectsData from "../data/projects.json";
import BaseLayout from "../layouts/BaseLayout.astro";

const { projects, categories } = projectsData;

// Filter only published projects and group by category
const publishedProjects = projects.filter(
  (project) => project.status === "published"
);
const projectsByCategory = publishedProjects.reduce(
  (acc, project) => {
    if (!acc[project.category]) {
      acc[project.category] = [];
    }
    acc[project.category].push(project);
    return acc;
  },
  {} as Record<string, typeof publishedProjects>
);
---

<BaseLayout title="Hasan Al Asim | Projects" sideBarActiveItemID="projects">
  {
    Object.entries(projectsByCategory).map(
      ([categoryKey, categoryProjects], categoryIndex) => (
        <>
          <div>
            <div class="text-3xl w-full font-bold mb-5 mt-10">
              {categories[categoryKey].title}
            </div>
          </div>

          {categoryProjects.map((project, projectIndex) => (
            <>
              <HorizontalCard
                title={project.title}
                img={project.image}
                desc={project.description}
                url={project.url}
                badge={project.badge}
              />
              {projectIndex < categoryProjects.length - 1 && (
                <div class="divider my-0" />
              )}
            </>
          ))}
        </>
      )
    )
  }
</BaseLayout>
